define(["config/main","App","Navi","Util"],function(t,e,n,r){var i=function(){this._mode=this.Mode.QUERY};return i.prototype.Mode={QUERY:"query",PATH:"path"},i.prototype.setMode=function(t){this._mode=t},i.prototype.init=function(t){var e=this;return n.bind(n.Event.URL_CHANGED,function(t){e._onUrlChanged(t.parameters)}),r.isString(t)&&this.setMode(t),this},i.prototype.navigate=function(t,e,n){switch(this._mode){case this.Mode.QUERY:return this._navigateQuery(t,e,n);case this.Mode.PATH:return this._navigatePath(t,e,n);default:throw Error('Invalid router mode "'+this._mode+'"')}},i.prototype._navigateQuery=function(t,n,i){var o={module:t,action:n};r.isObject(i)&&!r.isEmpty(i)&&(o.parameters=i),e.location.search(o),e.validate()},i.prototype._navigatePath=function(t,n,i){var o,a="/"+t+"/"+n;if(r.isObject(i)&&!r.isEmpty(i))for(o in i)a+=i[o]===!0?"/"+o:"/"+o+"="+i[o];e.location.path(a),e.validate()},i.prototype._onUrlChanged=function(t){switch(this._mode){case this.Mode.QUERY:return this._handleUrlChangeQuery(t);case this.Mode.PATH:return this._handleUrlChangePath(t);default:throw Error('Invalid router mode "'+this._mode+'"')}},i.prototype._handleUrlChangeQuery=function(e){var i=n.getCurrent();r.isString(e.args.module)&&r.isString(e.args.action)&&(null===i||e.args.module!==i.module||e.args.action!==i.action)?n._open(e.args.module,e.args.action,r.isObject(e.args.parameters)?e.args.parameters:{}):n._open(t.index.module,t.index.action,t.index.parameters)},i.prototype._handleUrlChangePath=function(e){var i,o,a,s,u=e.path,c=u.split("/"),l=t.index.module,f=t.index.action,h=t.index.parameters;if(c.length>=2&&c[1].length>0&&(l=c[1],h={}),c.length>=3&&c[2].length>0&&(f=c[2]),c.length>=4)for(i=3;c.length>i;i++)-1!==c[i].indexOf("=")?(o=c[i].split("="),a=o[0],s=r.normalizeType(o[1])):(a=c[i],s=!0),h[a]=s;n._open(l,f,h)},new i});