define(["Bindable","Util","underscore"],function(t,e,n){var r=function(){this._queue={error:[],log:[],console:[],alert:[]},this._archive={error:[],log:[],console:[],alert:[]};var t=this;this._nativeAlert=window.alert,window.alert=function(e){t.alert(e)},window.onerror=function(e,n,r){return t._onError(e,n,r)===!1?!1:!0}};return r.prototype=new t,r.prototype.Event={ERROR:"error",CONSOLE:"console",LOG:"log",ALERT:"alert"},r.prototype.init=function(){return this},r.prototype.error=function(){var t=this._getSource();return this._queue.error.push([n.toArray(arguments),t]),this._flush(),this},r.prototype.log=function(){var t=this._getSource();return this._queue.log.push([n.toArray(arguments),t]),this._flush(),this},r.prototype.console=function(){var t=this._getSource();return this._queue.console.push([n.toArray(arguments),t]),this._flush(),this},r.prototype.alert=function(){var t=this._getSource();return this._queue.alert.push([n.toArray(arguments),t]),this._flush(),this},r.prototype._onBind=function(){this._flush()},r.prototype._flush=function(){var t,e,n;if(this.numListeners(this.Event.ERROR)>0)for(;this._queue.error.length>0;)t=this._queue.error.shift(),e=t[0],n=t[1],this.fire({type:this.Event.ERROR,args:e,source:n}),this._archive.error.push(e);if(this.numListeners(this.Event.LOG)>0)for(;this._queue.log.length>0;)t=this._queue.log.shift(),e=t[0],n=t[1],this.fire({type:this.Event.LOG,args:e,source:n}),this._archive.log.push(e);if(this.numListeners(this.Event.CONSOLE)>0)for(;this._queue.console.length>0;)t=this._queue.console.shift(),e=t[0],n=t[1],this.fire({type:this.Event.CONSOLE,args:e,source:n}),this._archive.console.push(e);if(this.numListeners(this.Event.ALERT)>0)for(;this._queue.alert.length>0;)t=this._queue.alert.shift(),e=t[0],n=t[1],this.fire({type:this.Event.ALERT,args:e,source:n}),this._archive.alert.push(e)},r.prototype._onError=function(t,e,n){window.console.log("error",arguments),this.error(t,e,n)},r.prototype._getSource=function(t){t=t||3;try{var n=Error().stack.split("\n"),r=n[t],i=e.parseStackLine(r);return null===i?null:"Debug.js"==i.filename.substr(i.filename.length-8)&&3===t?this._getSource(5):i}catch(o){return null}},new r});