define(["EventEmitter","Util","jquery"],function(e,t,n){var r=function(){e.call(this),this._keyDown=[]};return r.prototype=Object.create(e.prototype),r.prototype.Event={KEYDOWN:"keydown",KEYUP:"keyup"},r.prototype.KC={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSEBREAK:19,CAPSLOCK:20,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:107,PRINTSCREEN:44,INSERT:45,DELETE:46,NUM_0:96,NUM_1:97,NUM_2:98,NUM_3:99,NUM_4:100,NUM_5:101,NUM_6:102,NUM_7:103,NUM_8:104,NUM_9:105,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,STAR:106,DASH:189,SLASH:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALS:187,COMMA:188,FULLSTOP:190,APOSTROPHE:192,LEFT_SQUARE_BRACKET:219,ESC:220,RIGHT_SQUARE_BRACKET:221,SINGLE_QUATE:222},r.KeyEvent=function(e,t,n,r,i,o,a,s){this.type=e,this.keyCode=t,this.name=n,this.alt=r,this.ctrl=i,this.shift=o,this.repeated=a,this.original=s},r.KeyEvent.prototype.stopPropagation=function(){null!==this.original&&this.original.stopPropagation()},r.prototype.init=function(){var e=this;return n(document.body).keydown(function(t){return e.consume(e.generate(e.Event.KEYDOWN,t.keyCode,t.altKey,t.ctrlKey,t.shiftKey,!1,t.originalEvent))}),n(document.body).keyup(function(t){return e.consume(e.generate(e.Event.KEYUP,t.keyCode,t.altKey,t.ctrlKey,t.shiftKey,!1,t.originalEvent))}),this},r.prototype.getKeyName=function(e){for(var t in this.KC)if(this.KC[t]===e)return t;return"KEY_UNKNOWN"},r.prototype.generate=function(e,n,i,o,a,s,l){return i=t.isBoolean(i)?i:!1,o=t.isBoolean(o)?o:!1,a=t.isBoolean(a)?a:!1,s=t.isBoolean(s)?s:!1,l=t.isUndefined(l)?null:l,new r.KeyEvent(e,n,this.getKeyName(n),i,o,a,s,l)},r.prototype.consume=function(e){if(e.type===this.Event.KEYDOWN)t.contains(this._keyDown,e.keyCode)?e.repeated=!0:(e.repeated=!1,this._keyDown.push(e.keyCode));else{if(e.type!==this.Event.KEYUP)throw Error('Unexpected key event type "'+e.type+'"');t.contains(this._keyDown,e.keyCode)&&t.remove(e.keyCode,this._keyDown)}return this.emit({type:e.type,info:e})},r.prototype.isKeyDown=function(e){return t.contains(this._keyDown,e)},new r});