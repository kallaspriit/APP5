/**
		 * Parses a URI into the following components:
		 * - source
		 * - protocol
		 * - authority
		 * - userInfo
		 * - user
		 * - password
		 * - host
		 * - port
		 * - relative
		 * - path
		 * - directory
		 * - file
		 * - query
		 * - anchor
		 *
		 * http://blog.stevenlevithan.com/archives/parseuri
		 * (c) Steven Levithan <stevenlevithan.com>
		 *
		 * @method parseUri
		 * @param {String} uri URI to parse
		 * @return {Object}
		 */

define(["Deferred","underscore"],function(e,t){var n={};return{round:function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},date:function(){return new Date},microtime:function(){return this.date().getTime()/1e3},clone:function(e){return t.clone(e)},extend:function(e,n){return this.noop(e,n),t.extend.apply(t,t.toArray(arguments))},contains:function(e,n){return t.contains(e,n)},str:function(e){if(null===e)return"null";if("string"===this.typeOf(e))return e;try{return JSON.stringify(e)}catch(t){return"[obj]"}},bool:function(e){return e?!0:!1},toArray:function(e){return t.toArray(e)},typeOf:function(e){return function(t){return t===void 0?"undefined":t===e?"global":{}.toString.call(t).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}}(this),sizeOf:function(e){if(this.isArray(e)||this.isString(e))return e.length;if(this.isObject(e)){var t,n=0;for(t in e)n++;return n}return 0},isFunction:function(e){return"function"===this.typeOf(e)},isString:function(e){return"string"===this.typeOf(e)},isBoolean:function(e){return"boolean"===this.typeOf(e)},isNumber:function(e){return"number"===this.typeOf(e)},isArray:function(e){return"array"===this.typeOf(e)},isObject:function(e){return"object"===this.typeOf(e)&&null!==e},isNull:function(e){return"null"===this.typeOf(e)},isDate:function(e){return"date"===this.typeOf(e)},isError:function(e){return"error"===this.typeOf(e)},isUndefined:function(e){return"undefined"===this.typeOf(e)},isEmpty:function(e){return t.isEmpty(e)},parseUrlParameters:function(e){var t,n,r,i,o,a=e.split("&"),s={};for(o in a)t=a[o],n=t.split("="),r=n[0],i=!0,2===n.length&&(i=n[1]),s[r]=i;return this.normalizeType(s)},formatBytes:function(e){if(e=parseFloat(e),isNaN(e))return"n/a";var t,n=e>=0?1:-1,r=Math.abs(e),i="";return r>1e6?(t=Math.floor(r/1e4)/100,i="m"):r>1e3?(t=Math.floor(r/100)/10,i="k"):t=r>1?Math.floor(r):Math.round(100*r)/100,""+t*n+i},getUrlParameters:function(){var e=window.location.href,t=e.indexOf("?");return-1==t?{}:this.parseUrlParameters(e.substr(t+1))},getHashParameters:function(){var e=window.location.hash,t=e.indexOf("#");return-1==t?{}:this.parseUrlParameters(e.substr(t+1))},parseURI:function(e){for(var t={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;i--;)r[t.key[i]]=n[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,i){n&&(r[t.q.name][n]=i)}),r},getBaseUrl:function(e){var t=this.parseURI(e||window.location.href);return t.protocol+"://"+t.host+t.directory},normalizeType:function(e){var t=this.typeOf(e);if("string"===t)return parseInt(e,10)==e?parseInt(e,10):parseFloat(e)==e?parseFloat(e):"true"===e.toLowerCase(e)?!0:"false"===e.toLowerCase(e)?!1:"null"===e.toLowerCase(e)?null:e;if("object"===t){for(var n in e)e.hasOwnProperty(n)&&(e[n]=this.normalizeType(e[n]));return e}if("array"===t){for(var r=0;e.length>r;r++)e[r]=this.normalizeType(e[r]);return e}return e},convertEntityName:function(e){for(var t;-1!=(t=e.indexOf("-"));)e=e.substr(0,t)+e.substr(t+1,1).toUpperCase()+e.substr(t+2);return e.substr(0,1).toUpperCase()+e.substr(1)},convertCallableName:function(e){for(var t;-1!=(t=e.indexOf("-"));)e=e.substr(0,t)+e.substr(t+1,1).toUpperCase()+e.substr(t+2);return e},convertToCamelCase:function(e){for(var t;-1!=(t=e.indexOf("_"));)e=e.substr(0,t)+e.substr(t+1,1).toUpperCase()+e.substr(t+2);return e},formatPath:function(e){var t=/http:\/\/.+?\/(.+)/,n=t.exec(e);return null===n?e:n[1]},remove:function(e,n){var r=this.typeOf(n);if("array"===r){var i=t.indexOf(n,e);return-1===i?!1:(n.splice(i,1),!0)}if("object"===r){var o;for(o in n)if(n[o]===e)return delete n[o],!0;return!1}throw Error("Unable to remove item, invalid collection")},parseStackLine:function(e){var t=/at (.+) \((.+):(\d+):(\d+)\)/,n=t.exec(e);return null===n?null:{method:n[1],filename:n[2],line:parseInt(n[3],10),column:parseInt(n[4],10)}},sprintf:function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){var n,r=[];for(n=t;t>0;t--)r[t]=e;return r.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};n.format=function(n,r){var i,o,a,s,l,u,c,p=1,f=n.length,d="",h=[];for(o=0;f>o;o++)if(d=e(n[o]),"string"===d)h.push(n[o]);else if("array"===d){if(s=n[o],s[2])for(i=r[p],a=0;s[2].length>a;a++){if(!i.hasOwnProperty(s[2][a]))throw Error('[sprintf] property "'+s[2][a]+'" does not exist');i=i[s[2][a]]}else i=s[1]?r[s[1]]:r[p++];if(/[^s]/.test(s[8])&&"number"!==e(i))throw Error("[sprintf] expecting number but found "+e(i));switch(s[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=s[7]?i.toExponential(s[7]):i.toExponential();break;case"f":i=s[7]?parseFloat(i).toFixed(s[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i+="")&&s[7]?i.substring(0,s[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(s[8])&&s[3]&&i>=0?"+"+i:i,u=s[4]?"0"==s[4]?"0":s[4].charAt(1):" ",c=s[6]-(i+"").length,l=s[6]?t(u,c):"",h.push(s[5]?i+l:l+i)}return h.join("")},n.cache={};var r=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/;return n.parse=function(e){for(var t=e,n=[],i=[],o=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))i.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))i.push("%");else{if(null===(n=r.exec(t)))throw Error("[sprintf] huh?");if(n[2]){o|=1;var a=[],s=n[2],l=[];if(null===(l=/^([a-z_][a-z_\d]*)/i.exec(s)))throw Error("[sprintf] huh?");for(a.push(l[1]);""!==(s=s.substring(l[0].length));)if(null!==(l=/^\.([a-z_][a-z_\d]*)/i.exec(s)))a.push(l[1]);else{if(null===(l=/^\[(\d+)\]/.exec(s)))throw Error("[sprintf] huh?");a.push(l[1])}n[2]=a}else o|=2;if(3===o)throw Error("[sprintf] mixing positional and named placeholders is not supported");i.push(n)}t=t.substring(n[0].length)}return i},n}(),vsprintf:function(e,t){return t.unshift(e),this.sprintf.apply(null,t)},performDelayed:function(e,t,r){if(!this.isFunction(t))throw Error("Expected function as callback parameter");r=r||1e3,this.isUndefined(n[e])||null===n[e]||(window.clearTimeout(n[e]),n[e]=null),n[e]=window.setTimeout(function(){n[this.name]=null,t()}.bind({name:e}),r)},when:function(){return e.when.apply(window,arguments)},uid:function(){var e=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},limit:function(e,t,n){return this.isNumber(e)?this.isUndefined(n)?Math.max(e,t):Math.min(Math.max(e,t),n):e},noop:function(){}}});