define(["jquery","underscore","config/main","Bindable","ResourceManager","Debug","DebugRenderer","Util","Translator","angular"],function(t,e,n,r,i,o,s,a,u,c){var l=null,f=function(){this._module=null,this._transitioning=!1};return f.prototype=new r,f.prototype.Event={READY:"ready",MODAL_SHOWN:"modal-shown",MODAL_HIDDEN:"modal-hidden",SWIPE:"swipe"},f.prototype.init=function(){var e=this;return require(["Navi"],function(n){l=n,t(document).ready(function(){e._onDocumentReady()})}),this},f.prototype.setModule=function(t){return this._module=t,this},f.prototype.transitionView=function(e,r,i,o,s){i=a.isBoolean(i)?i:!1,this._transitioning&&alert("already transitioning"),this._transitioning=!0;var u=this,c=t(e),l=t(r),f=n.cssPrefix,h=t(document.body),p=n.pageTransition,d=["slide","slideup","slidedown"],m=a.contains(d,p);if(t(document.body).scrollTop(0),c.length>0){h.addClass(f+"transitioning "+f+"transition-"+p),i&&(c.addClass(f+"reverse"),l.addClass(f+"reverse")),c.addClass(f+p+" "+f+"out"),m&&l.addClass(f+"page-active "+f+p+" "+f+"in");var g="animationEnd animationend oAnimationEnd msAnimationEnd mozAnimationEnd webkitAnimationEnd transitionend oTransitionEnd otransitionend webkitTransitionEnd MSTransitionEnd";c.bind(g,function(){c.removeClass(f+p+" "+f+"out "+f+"page-active "+f+"reverse"),m||l.addClass(f+"page-active "+f+p+" "+f+"in"),c.unbind(g)}),l.bind(g,function(){l.removeClass(f+p+" "+f+"in "+f+"reverse"),h.removeClass(f+"transitioning "+f+"transition-"+p),l.unbind(g),o&&c.length>0&&c.remove(),u._transitioning=!1,a.isFunction(s)&&s()})}else l.addClass(f+"page-active"),this._transitioning=!1,a.isFunction(s)&&s()},f.prototype.isTransitioning=function(){return this._transitioning},f.prototype.openModal=function(t,e,n,r){this.showModal('<div id="modal-content"></div>',r,function(){l.partial("#modal-content",t,e,n)})},f.prototype.showModal=function(e,n,r){var o=this,s="partials/modal.html",u=t("#modal");u.length>0&&u.remove(),i.loadView(s).done(function(i){t(document.body).append(i),t("#modal").html(e).modal(a.isObject(n)?n:{}).on("shown",function(){o.fire({type:o.Event.MODAL_SHOWN,modal:t(this)})}).on("hidden",function(){t(this).remove(),o.fire({type:o.Event.MODAL_HIDDEN})}),a.isFunction(r)&&r()}).fail(function(){throw Error("Loading modal template from "+s+" failed")})},f.prototype.hideModal=function(){t("#modal").modal("hide")},f.prototype.showView=function(e,r,i,o,s,u,f,h){var p,d=this,m=l.getCurrent(),g=l.getExistingItem(e,r),v=!1;if(null!==g){for(var y=l.getStack();y.length>0&&(p=y.pop(),p===m||(p.fire(this.Event.EXIT),p.injector.get("$rootScope").$emit("$destroy"),p.container.remove(),p.module!==e||p.action!==r)););v=!0}var b,$=l.appendNavigation(e,r,s,u),w=n.cssPrefix,x="content-"+$.id,E=t(n.viewSelector),_=E.find("."+w+"page-active");return E.append('<div id="'+x+'" class="'+w+"page "+e+"-module "+r+'-action"></div>'),b=t("#"+x).html(f).attr("ng-controller",i+"."+o),this._module.value("parameters",s),this._module.controller(i+"."+o,u[o]),$.container=b,$.injector=c.bootstrap(b,["app"]),$.fire=function(t,e){this.injector.get("$rootScope").$broadcast(t,e)},null!==m&&v!==!0&&m.fire(this.Event.SLEEP),this.transitionView(_,b,v,!1,function(){v&&(m.fire(d.Event.EXIT),m.container.remove()),a.isFunction(h)&&h()}),$},f.prototype.showPartial=function(e,n,r,i,o,s,a,u,l){var f=t(u);if(0===f.length)throw Error('Partial container for "'+u+'" not found');if(l){var h=t(a).attr("id");f.append(a),t("#"+h).attr("ng-controller",r+"."+i)}else f.html(a).attr("ng-controller",r+"."+i);this._module.value("parameters",o),this._module.controller(r+"."+i,s[i]),c.bootstrap(f,["app"])},f.prototype.confirm=function(n,r,o){var s=this,c="partials/confirm.html",l=t("#confirm");if(l.length>0&&l.remove(),r=r||"confirm-title",o=o||"confirm-text",u.has(r)&&(r=u.translate(r)),u.has(o)){var f=[];arguments.length>3&&(f=e.toArray(arguments).slice(3)),f.unshift(o),o=u.translate.apply(u,f)}i.loadView(c).done(function(e){t(document.body).append(e),t("#confirm-title").html(r),t("#confirm-content").html(o),t("#confirm-btn").click(function(){a.isFunction(n)&&n(),t("#confirm").modal("hide")}),t("#confirm").modal().on("shown",function(){s.fire({type:s.Event.MODAL_SHOWN,modal:t(this)})}).on("hidden",function(){t(this).remove(),s.fire({type:s.Event.MODAL_HIDDEN})})}).fail(function(){throw Error("Loading confirm template from "+c+" failed")})},f.prototype._onDocumentReady=function(){var e=this;n.debug&&s.init(this),t(document.body).hammer().bind("swipe",function(t){var n=t.position.x-t.distanceX,r=t.position.y-t.distanceY;e._onSwipe(t.direction,{x:t.distanceX,y:t.distanceY},{x:n,y:r},t.position)}),"ontouchstart"in document&&t(document.body).removeClass("no-touch").addClass("with-touch"),this.fire({type:this.Event.READY})},f.prototype._onSwipe=function(t,e,n,r){return this.fire({type:this.Event.SWIPE,direction:t,distance:e,startPosition:n,endPosition:r}),"right"===t&&Math.abs(e.x)>=100?(require(["Navi"],function(t){t.back()}),!1):void 0},new f});