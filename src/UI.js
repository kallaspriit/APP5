define(["jquery","underscore","config/main","Bindable","App","ResourceManager","Debug","DebugRenderer","Util","Translator"],function(t,e,n,r,i,o,s,a,u,c){var l=null,f=function(){this._transitioning=!1};return f.prototype=new r,f.prototype.Event={READY:"ready",MODAL_SHOWN:"modal-shown",MODAL_HIDDEN:"modal-hidden",SWIPE:"swipe"},f.prototype.init=function(){var e=this;return require(["Navi"],function(n){l=n,t(document).ready(function(){e._onDocumentReady()})}),this},f.prototype.transitionView=function(e,r,i,o,s){i=u.isBoolean(i)?i:!1,this._transitioning&&alert("already transitioning"),this._transitioning=!0;var a=this,c=t(e),l=t(r),f=n.cssPrefix,h=t(document.body),p=n.pageTransition,d=["slide","slideup","slidedown"],m=u.contains(d,p);if(t(document.body).scrollTop(0),c.length>0){h.addClass(f+"transitioning "+f+"transition-"+p),i&&(c.addClass(f+"reverse"),l.addClass(f+"reverse")),c.addClass(f+p+" "+f+"out"),m&&l.addClass(f+"page-active "+f+p+" "+f+"in");var g="animationEnd animationend oAnimationEnd msAnimationEnd mozAnimationEnd webkitAnimationEnd transitionend oTransitionEnd otransitionend webkitTransitionEnd MSTransitionEnd";c.bind(g,function(){c.removeClass(f+p+" "+f+"out "+f+"page-active "+f+"reverse"),m||l.addClass(f+"page-active "+f+p+" "+f+"in"),c.unbind(g)}),l.bind(g,function(){l.removeClass(f+p+" "+f+"in "+f+"reverse"),h.removeClass(f+"transitioning "+f+"transition-"+p),l.unbind(g),o&&c.length>0&&c.remove(),a._transitioning=!1,u.isFunction(s)&&s()})}else l.addClass(f+"page-active"),this._transitioning=!1,u.isFunction(s)&&s()},f.prototype.isTransitioning=function(){return this._transitioning},f.prototype.openModal=function(t,e,n,r){this.showModal('<div id="modal-content"></div>',r,function(){l.partial("#modal-content",t,e,n)})},f.prototype.showModal=function(e,n,r){var i=this,s="partials/modal.html",a=t("#modal");a.length>0&&a.remove(),o.loadView(s).done(function(o){t(document.body).append(o),t("#modal").html(e).modal(u.isObject(n)?n:{}).on("shown",function(){i.fire({type:i.Event.MODAL_SHOWN,modal:t(this)})}).on("hidden",function(){t(this).remove(),i.fire({type:i.Event.MODAL_HIDDEN})}),u.isFunction(r)&&r()}).fail(function(){throw Error("Loading modal template from "+s+" failed")})},f.prototype.hideModal=function(){t("#modal").modal("hide")},f.prototype.showView=function(e,r,o,s,a,c,f,h){var p,d=this,m=l.getCurrent(),g=l.getExistingItem(e,r),v=!1;if(null!==g){for(var y=l.getStack();y.length>0&&(p=y.pop(),p===m||(p.fire(this.Event.EXIT),p.container.remove(),p.module!==e||p.action!==r)););v=!0}var b,$=l.appendNavigation(e,r,a,c),w=n.cssPrefix,x="content-"+$.id,E=t(n.viewSelector),_=E.find("."+w+"page-active");return E.append('<div id="'+x+'" class="'+w+"page "+e+"-module "+r+'-action"></div>'),b=t("#"+x).html(f).attr("ng-controller",o+"."+s),i.provide.value("parameters",a),i.registerController(o+"."+s,c[s]),$.container=b,$.fire=function(t,e){i.broadcast(t,e)},i.compile(b)(i.baseScope),null!==m&&v!==!0&&m.fire(this.Event.SLEEP),this.transitionView(_,b,v,!1,function(){v&&(m.fire(d.Event.EXIT),m.container.remove()),u.isFunction(h)&&h()}),$},f.prototype.showPartial=function(e,n,r,o,s,a,u,c,l){var f,h=t(c),p=r+"-"+o;if(0===h.length)throw Error('Partial container for "'+c+'" not found');l?(f=t(u).attr("id"),h.append(u),t("#"+f).attr("ng-controller",p)):h.html(u).attr("ng-controller",p),i.provide.value("parameters",s),i.registerController(p,a[o]),i.compile(h)(i.baseScope)},f.prototype.confirm=function(n,r,s){var a=this,l="partials/confirm.html",f=t("#confirm");if(f.length>0&&f.remove(),r=r||"confirm-title",s=s||"confirm-text",c.has(r)&&(r=c.translate(r)),c.has(s)){var h=[];arguments.length>3&&(h=e.toArray(arguments).slice(3)),h.unshift(s),s=c.translate.apply(c,h)}o.loadView(l).done(function(e){t(document.body).append(e),t("#confirm-title").html(r),t("#confirm-content").html(s),t("#confirm-btn").click(function(){u.isFunction(n)&&n(),t("#confirm").modal("hide")}),t("#confirm").modal().on("shown",function(){a.fire({type:a.Event.MODAL_SHOWN,modal:t(this)}),i.validate()}).on("hidden",function(){t(this).remove(),a.fire({type:a.Event.MODAL_HIDDEN}),i.validate()})}).fail(function(){throw Error("Loading confirm template from "+l+" failed")})},f.prototype._onDocumentReady=function(){var e=this;n.debug&&a.init(this),t(document.body).hammer().bind("swipe",function(t){var n=t.position.x-t.distanceX,r=t.position.y-t.distanceY;e._onSwipe(t.direction,{x:t.distanceX,y:t.distanceY},{x:n,y:r},t.position)}),"ontouchstart"in document&&t(document.body).removeClass("no-touch").addClass("with-touch"),this.fire({type:this.Event.READY})},f.prototype._onSwipe=function(t,e,n,r){return this.fire({type:this.Event.SWIPE,direction:t,distance:e,startPosition:n,endPosition:r}),"right"===t&&Math.abs(e.x)>=100?(require(["Navi"],function(t){t.back()}),!1):void 0},new f});