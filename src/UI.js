define(["jquery","underscore","config/main","EventEmitter","App","ResourceManager","Debug","DebugRenderer","Util","Translator"],function(e,t,n,r,i,o,a,s,l,u){var c=null,p=function(){r.call(this),this._transitioning=!1};return p.prototype=Object.create(r.prototype),p.prototype.Event={READY:"ready",MODAL_SHOWN:"modal-shown",MODAL_HIDDEN:"modal-hidden"},p.prototype.init=function(){var t=this;return require(["Navi"],function(n){c=n,e(document).ready(function(){t._onDocumentReady()})}),this},p.prototype.transitionView=function(t,r,i,o){i=l.isBoolean(i)?i:!1,this._transitioning=!0;var a=this,s=e(t),u=e(r),c=n.cssPrefix,p=e(document.body),f=n.pageTransition,d=["slide","slideup","slidedown"],h=l.contains(d,f);if(e(document.body).scrollTop(0),s.length>0){p.addClass(c+"transitioning "+c+"transition-"+f),i&&(s.addClass(c+"reverse"),u.addClass(c+"reverse")),s.addClass(c+f+" "+c+"out"),h&&u.addClass(c+"page-active "+c+f+" "+c+"in");var m="animationEnd animationend oAnimationEnd msAnimationEnd mozAnimationEnd webkitAnimationEnd transitionend oTransitionEnd otransitionend webkitTransitionEnd MSTransitionEnd";s.bind(m,function(){s.removeClass(c+f+" "+c+"out "+c+"page-active "+c+"reverse"),h||u.addClass(c+"page-active "+c+f+" "+c+"in"),s.unbind(m)}),u.bind(m,function(){u.removeClass(c+f+" "+c+"in "+c+"reverse"),p.removeClass(c+"transitioning "+c+"transition-"+f),u.unbind(m),a._transitioning=!1,l.isFunction(o)&&o()})}else u.addClass(c+"page-active"),this._transitioning=!1,l.isFunction(o)&&o()},p.prototype.isTransitioning=function(){return this._transitioning},p.prototype.openModal=function(e,t,n,r){this.showModal('<div id="modal-content"></div>',r,function(){c.partial("#modal-content",e,t,n)})},p.prototype.showModal=function(t,n,r){var i=this,a="partials/modal.html",s=e("#modal");s.length>0&&s.remove(),o.loadView(a).done(function(o){e(document.body).append(o),e("#modal").html(t).modal(l.isObject(n)?n:{}).on("shown",function(){i.emit({type:i.Event.MODAL_SHOWN,modal:e(this)})}).on("hidden",function(){e(this).remove(),i.emit({type:i.Event.MODAL_HIDDEN})}),l.isFunction(r)&&r()}).fail(function(){throw Error("Loading modal template from "+a+" failed")})},p.prototype.hideModal=function(){e("#modal").modal("hide")},p.prototype.showView=function(t,r,o,s,l,u,c,p,f,d,h,m){if(h)return this.transitionView(p,f,h,m),null;var g,v=n.cssPrefix,y="content-"+d,b=e(n.viewSelector),$=b.find("."+v+"page-active");b.append('<div id="'+y+'" class="'+v+"page "+t+"-module "+r+'-action"></div>'),g=e("#"+y).html(c).attr("ng-controller",o+"."+s);try{i.compile(g)(i.baseScope),this.transitionView($,g,h,m)}catch(w){a.error(w)}return g},p.prototype.showPartial=function(t,n,r,o,s,l,u,c,p){var f,d=e(c),h=r+"-"+o;if(0===d.length)throw Error('Partial container for "'+c+'" not found');p?(f=e(u).attr("id"),d.append(u),e("#"+f).attr("ng-controller",h)):d.html(u).attr("ng-controller",h),i.parameters=s,i.registerController(h,l[o]);try{i.compile(d)(i.baseScope)}catch(m){a.error(m)}},p.prototype.confirm=function(n,r,a){var s=this,c="partials/confirm.html",p=e("#confirm");if(p.length>0&&p.remove(),r=r||"confirm-title",a=a||"confirm-text",u.has(r)&&(r=u.translate(r)),u.has(a)){var f=[];arguments.length>3&&(f=t.toArray(arguments).slice(3)),f.unshift(a),a=u.translate.apply(u,f)}o.loadView(c).done(function(t){e(document.body).append(t),e("#confirm-title").html(r),e("#confirm-content").html(a),e("#confirm-btn").click(function(){l.isFunction(n)&&n(),e("#confirm").modal("hide")}),e("#confirm").modal().on("shown",function(){s.emit({type:s.Event.MODAL_SHOWN,modal:e(this)}),i.validate()}).on("hidden",function(){e(this).remove(),s.emit({type:s.Event.MODAL_HIDDEN}),i.validate()})}).fail(function(){throw Error("Loading confirm template from "+c+" failed")})},p.prototype._onDocumentReady=function(){n.debug&&(s.init(this),window.app.debugRenderer=s),"ontouchstart"in document&&e(document.body).removeClass("no-touch").addClass("with-touch"),this.emit({type:this.Event.READY})},new p});