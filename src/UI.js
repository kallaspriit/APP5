define(["jquery","underscore","config/main","Bindable","App","ResourceManager","Debug","DebugRenderer","Util","Translator"],function(t,e,n,r,i,o,a,s,u,l){var c=null,f=function(){this._transitioning=!1};return f.prototype=new r,f.prototype.Event={READY:"ready",MODAL_SHOWN:"modal-shown",MODAL_HIDDEN:"modal-hidden",SWIPE:"swipe"},f.prototype.init=function(){var e=this;return require(["Navi"],function(n){c=n,t(document).ready(function(){e._onDocumentReady()})}),this},f.prototype.transitionView=function(e,r,i,o){i=u.isBoolean(i)?i:!1,this._transitioning=!0;var a=this,s=t(e),l=t(r),c=n.cssPrefix,f=t(document.body),h=n.pageTransition,p=["slide","slideup","slidedown"],d=u.contains(p,h);if(t(document.body).scrollTop(0),s.length>0){f.addClass(c+"transitioning "+c+"transition-"+h),i&&(s.addClass(c+"reverse"),l.addClass(c+"reverse")),s.addClass(c+h+" "+c+"out"),d&&l.addClass(c+"page-active "+c+h+" "+c+"in");var m="animationEnd animationend oAnimationEnd msAnimationEnd mozAnimationEnd webkitAnimationEnd transitionend oTransitionEnd otransitionend webkitTransitionEnd MSTransitionEnd";s.bind(m,function(){s.removeClass(c+h+" "+c+"out "+c+"page-active "+c+"reverse"),d||l.addClass(c+"page-active "+c+h+" "+c+"in"),s.unbind(m)}),l.bind(m,function(){l.removeClass(c+h+" "+c+"in "+c+"reverse"),f.removeClass(c+"transitioning "+c+"transition-"+h),l.unbind(m),a._transitioning=!1,u.isFunction(o)&&o()})}else l.addClass(c+"page-active"),this._transitioning=!1,u.isFunction(o)&&o()},f.prototype.isTransitioning=function(){return this._transitioning},f.prototype.openModal=function(t,e,n,r){this.showModal('<div id="modal-content"></div>',r,function(){c.partial("#modal-content",t,e,n)})},f.prototype.showModal=function(e,n,r){var i=this,a="partials/modal.html",s=t("#modal");s.length>0&&s.remove(),o.loadView(a).done(function(o){t(document.body).append(o),t("#modal").html(e).modal(u.isObject(n)?n:{}).on("shown",function(){i.fire({type:i.Event.MODAL_SHOWN,modal:t(this)})}).on("hidden",function(){t(this).remove(),i.fire({type:i.Event.MODAL_HIDDEN})}),u.isFunction(r)&&r()}).fail(function(){throw Error("Loading modal template from "+a+" failed")})},f.prototype.hideModal=function(){t("#modal").modal("hide")},f.prototype.showView=function(e,r,o,s,u,l,c,f,h,p,d,m){if(d)return this.transitionView(f,h,d,m),null;var g,v=n.cssPrefix,y="content-"+p,b=t(n.viewSelector),$=b.find("."+v+"page-active");b.append('<div id="'+y+'" class="'+v+"page "+e+"-module "+r+'-action"></div>'),g=t("#"+y).html(c).attr("ng-controller",o+"."+s);try{i.compile(g)(i.baseScope),this.transitionView($,g,d,m)}catch(w){a.error(w)}return g},f.prototype.showPartial=function(e,n,r,o,s,u,l,c,f){var h,p=t(c),d=r+"-"+o;if(0===p.length)throw Error('Partial container for "'+c+'" not found');f?(h=t(l).attr("id"),p.append(l),t("#"+h).attr("ng-controller",d)):p.html(l).attr("ng-controller",d),i.parameters=s,i.registerController(d,u[o]);try{i.compile(p)(i.baseScope)}catch(m){a.error(m)}},f.prototype.confirm=function(n,r,a){var s=this,c="partials/confirm.html",f=t("#confirm");if(f.length>0&&f.remove(),r=r||"confirm-title",a=a||"confirm-text",l.has(r)&&(r=l.translate(r)),l.has(a)){var h=[];arguments.length>3&&(h=e.toArray(arguments).slice(3)),h.unshift(a),a=l.translate.apply(l,h)}o.loadView(c).done(function(e){t(document.body).append(e),t("#confirm-title").html(r),t("#confirm-content").html(a),t("#confirm-btn").click(function(){u.isFunction(n)&&n(),t("#confirm").modal("hide")}),t("#confirm").modal().on("shown",function(){s.fire({type:s.Event.MODAL_SHOWN,modal:t(this)}),i.validate()}).on("hidden",function(){t(this).remove(),s.fire({type:s.Event.MODAL_HIDDEN}),i.validate()})}).fail(function(){throw Error("Loading confirm template from "+c+" failed")})},f.prototype._onDocumentReady=function(){var e=this;n.debug&&(s.init(this),window.app.debugRenderer=s),t(document.body).hammer().bind("swipe",function(t){var n=t.position.x-t.distanceX,r=t.position.y-t.distanceY;e._onSwipe(t.direction,{x:t.distanceX,y:t.distanceY},{x:n,y:r},t.position)}),"ontouchstart"in document&&t(document.body).removeClass("no-touch").addClass("with-touch"),this.fire({type:this.Event.READY})},f.prototype._onSwipe=function(t,e,n,r){return this.fire({type:this.Event.SWIPE,direction:t,distance:e,startPosition:n,endPosition:r}),"right"===t&&Math.abs(e.x)>=100?(require(["Navi"],function(t){t.back()}),!1):void 0},new f});