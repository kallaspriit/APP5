define(["jquery","underscore","config/main","Bindable","App","ResourceManager","Debug","DebugRenderer","Util","Translator"],function(t,e,n,r,i,o,a,s,u,c){var l=null,f=function(){this._transitioning=!1};return f.prototype=new r,f.prototype.Event={READY:"ready",MODAL_SHOWN:"modal-shown",MODAL_HIDDEN:"modal-hidden",SWIPE:"swipe"},f.prototype.init=function(){var e=this;return require(["Navi"],function(n){l=n,t(document).ready(function(){e._onDocumentReady()})}),this},f.prototype.transitionView=function(e,r,i,o,a){i=u.isBoolean(i)?i:!1,this._transitioning=!0;var s=this,c=t(e),l=t(r),f=n.cssPrefix,h=t(document.body),p=n.pageTransition,d=["slide","slideup","slidedown"],m=u.contains(d,p);if(t(document.body).scrollTop(0),c.length>0){h.addClass(f+"transitioning "+f+"transition-"+p),i&&(c.addClass(f+"reverse"),l.addClass(f+"reverse")),c.addClass(f+p+" "+f+"out"),m&&l.addClass(f+"page-active "+f+p+" "+f+"in");var g="animationEnd animationend oAnimationEnd msAnimationEnd mozAnimationEnd webkitAnimationEnd transitionend oTransitionEnd otransitionend webkitTransitionEnd MSTransitionEnd";c.bind(g,function(){c.removeClass(f+p+" "+f+"out "+f+"page-active "+f+"reverse"),m||l.addClass(f+"page-active "+f+p+" "+f+"in"),c.unbind(g)}),l.bind(g,function(){l.removeClass(f+p+" "+f+"in "+f+"reverse"),h.removeClass(f+"transitioning "+f+"transition-"+p),l.unbind(g),o&&c.length>0&&c.remove(),s._transitioning=!1,u.isFunction(a)&&a()})}else l.addClass(f+"page-active"),this._transitioning=!1,u.isFunction(a)&&a()},f.prototype.isTransitioning=function(){return this._transitioning},f.prototype.openModal=function(t,e,n,r){this.showModal('<div id="modal-content"></div>',r,function(){l.partial("#modal-content",t,e,n)})},f.prototype.showModal=function(e,n,r){var i=this,a="partials/modal.html",s=t("#modal");s.length>0&&s.remove(),o.loadView(a).done(function(o){t(document.body).append(o),t("#modal").html(e).modal(u.isObject(n)?n:{}).on("shown",function(){i.fire({type:i.Event.MODAL_SHOWN,modal:t(this)})}).on("hidden",function(){t(this).remove(),i.fire({type:i.Event.MODAL_HIDDEN})}),u.isFunction(r)&&r()}).fail(function(){throw Error("Loading modal template from "+a+" failed")})},f.prototype.hideModal=function(){t("#modal").modal("hide")},f.prototype.showView=function(e,r,o,s,c,f,h,p){var d,m=this,g=l.getCurrent(),v=l.getExistingItem(e,r),y=!1;if(null!==v){for(var b=l.getStack();b.length>0&&(d=b.pop(),d===g||(d.fire(this.Event.EXIT),d.container.remove(),d.module!==e||d.action!==r)););y=!0}var $,w=l.appendNavigation(e,r,c,f),x=n.cssPrefix,E="content-"+w.id,_=t(n.viewSelector),T=_.find("."+x+"page-active");_.append('<div id="'+E+'" class="'+x+"page "+e+"-module "+r+'-action"></div>'),$=t("#"+E).html(h).attr("ng-controller",o+"."+s),i.provide.value("parameters",c),i.registerController(o+"."+s,f[s]),w.container=$,w.fire=function(t,e){i.broadcast(t,e)};try{i.compile($)(i.baseScope),null!==g&&y!==!0&&g.fire(this.Event.SLEEP),this.transitionView(T,$,y,!1,function(){y&&(g.fire(m.Event.EXIT),g.container.remove()),u.isFunction(p)&&p()})}catch(C){a.error(C)}return w},f.prototype.showPartial=function(e,n,r,o,a,s,u,c,l){var f,h=t(c),p=r+"-"+o;if(0===h.length)throw Error('Partial container for "'+c+'" not found');l?(f=t(u).attr("id"),h.append(u),t("#"+f).attr("ng-controller",p)):h.html(u).attr("ng-controller",p),i.provide.value("parameters",a),i.registerController(p,s[o]),i.compile(h)(i.baseScope)},f.prototype.confirm=function(n,r,a){var s=this,l="partials/confirm.html",f=t("#confirm");if(f.length>0&&f.remove(),r=r||"confirm-title",a=a||"confirm-text",c.has(r)&&(r=c.translate(r)),c.has(a)){var h=[];arguments.length>3&&(h=e.toArray(arguments).slice(3)),h.unshift(a),a=c.translate.apply(c,h)}o.loadView(l).done(function(e){t(document.body).append(e),t("#confirm-title").html(r),t("#confirm-content").html(a),t("#confirm-btn").click(function(){u.isFunction(n)&&n(),t("#confirm").modal("hide")}),t("#confirm").modal().on("shown",function(){s.fire({type:s.Event.MODAL_SHOWN,modal:t(this)}),i.validate()}).on("hidden",function(){t(this).remove(),s.fire({type:s.Event.MODAL_HIDDEN}),i.validate()})}).fail(function(){throw Error("Loading confirm template from "+l+" failed")})},f.prototype._onDocumentReady=function(){var e=this;n.debug&&(s.init(this),window.app.debugRenderer=s),t(document.body).hammer().bind("swipe",function(t){var n=t.position.x-t.distanceX,r=t.position.y-t.distanceY;e._onSwipe(t.direction,{x:t.distanceX,y:t.distanceY},{x:n,y:r},t.position)}),"ontouchstart"in document&&t(document.body).removeClass("no-touch").addClass("with-touch"),this.fire({type:this.Event.READY})},f.prototype._onSwipe=function(t,e,n,r){return this.fire({type:this.Event.SWIPE,direction:t,distance:e,startPosition:n,endPosition:r}),"right"===t&&Math.abs(e.x)>=100?(require(["Navi"],function(t){t.back()}),!1):void 0},new f});