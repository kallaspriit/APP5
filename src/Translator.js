define(["EventEmitter","Util","underscore"],function(e,t,n){var r=function(){e.call(this),this._language=null,this._translations={}};return r.prototype=Object.create(e.prototype),r.prototype.Event={LANGUAGE_CHANGED:"language-changed"},r.prototype.init=function(e,n){return t.isObject(e)&&this.setTranslations(e),t.isString(n)&&this.setLanguage(n),this},r.prototype.setTranslations=function(e){return this._translations=e,this},r.prototype.appendTranslations=function(e){return t.extend(this._translations,e),this},r.prototype.addTranslation=function(e,n,r){return t.isObject(this._translations[e])||(this._translations[e]={}),this._translations[e][n]=r,this},r.prototype.setLanguage=function(e){var t=this._language;return this._language=e,this.emit({type:this.Event.LANGUAGE_CHANGED,newLanguage:e,previousLanguage:t}),this},r.prototype.getLanguage=function(){return this._language},r.prototype.getLanguages=function(e){e=t.isBoolean(e)?e:!1;var n,r,i=[];for(n in this._translations){for(r in this._translations[n])e?i.push({id:r,name:this.has("lang."+r)?this.translate("lang."+r):r}):i.push(r);break}return i},r.prototype.has=function(e){return t.isString(e)&&t.isObject(this._translations[e])&&t.isString(this._translations[e][this._language])?!0:!1},r.prototype.translate=function(e){if(!t.isString(e)||!t.isObject(this._translations[e])||!t.isString(this._translations[e][this._language]))return e;var r=n.toArray(arguments);return r[0]=this._translations[e][this._language],t.sprintf.apply(t,r)},new r});