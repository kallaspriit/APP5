define(["Deferred","Util","Navi"],function(e,t,n){var r=function(){this._timeouts={},this._intervals={}};return r.prototype.init=function(){var e=this;return n.on(n.Event.PRE_NAVIGATE,function(){e.clear(null,!1)}),this},r.Timeout=function(n,r,i,o,a,s){var l=this;this._component=n,this._callback=r,this._milliseconds=i,this._persistent=o,this._parameters=a,this._interval=s,this._alive=!0,this._counter=0,this._id=this._interval?window.setInterval(function(){l._counter++,t.isFunction(r)&&r.apply(l,a)},i):window.setTimeout(function(){l._alive=!1,t.isFunction(r)&&r.apply(l,a),l.resolve.apply(l,[l,"fired"])},i),t.extend(this,new e)},r.Timeout.prototype.isAlive=function(){return this._alive},r.Timeout.prototype.isPersistent=function(){return this._persistent},r.Timeout.prototype.isInterval=function(){return this._interval},r.Timeout.prototype.cancel=function(){this._alive&&(this._interval?window.clearInterval(this._id):window.clearTimeout(this._id),this.resolve(this,"cancel"),this._alive=!1)},r.prototype.setTimeout=function(e,n,i,o,a){t.isFunction(e)&&(e="general",n=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3]),o=t.isUndefined(o)?!1:t.bool(o),a=a||[];var s=6===arguments.length&&arguments[5]===!0,l=new r.Timeout(e,n,i,o,a,s);return t.isUndefined(this._timeouts[e])&&(this._timeouts[e]=[]),this._timeouts[e].push(l),this._purge(),l},r.prototype.setInterval=function(e,t,n,r,i){return this.setTimeout(e,t,n,r,i,!0)},r.prototype.clearTimeouts=function(e,n){e=e||null,n=t.isUndefined(n)?!0:t.bool(n);var r,i,o=3===arguments.length&&arguments[2]===!0;for(r in this._timeouts)if(null===e||r===e){for(i=0;this._timeouts[r].length>i;i++)!n&&this._timeouts[r][i].isPersistent()||this._timeouts[r][i].isInterval()!==o||this._timeouts[r][i].cancel(),this._timeouts[r].splice(i,1);0===this._timeouts[r].length&&delete this._timeouts[r]}},r.prototype.clearIntervals=function(e,t){this.clearTimeouts(e,t,!0)},r.prototype.clear=function(e,t){this.clearTimeouts(e,t),this.clearIntervals(e,t)},r.prototype._purge=function(){var e,t;for(e in this._timeouts)for(t=0;this._timeouts[e].length>t;t++)this._timeouts[e][t].isAlive()||this._timeouts[e].splice(t,1)},new r});